var kiaModels = {

    "sportage2017": { "label": "스포티지", "build": "sportage", "year": "2017", "msrp": "23200", "mpg": "26", "cat": "crossover", "korean": true, "awards": true, "review": "kbb", "altbuild": "" },
    "optima2017": { "label": "옵티마", "build": "optima", "year": "2017", "msrp": "22200", "mpg": "31", "cat": "midlux", "korean": true, "awards": true, "review": "kbb", "altbuild": "" },
//  "optima2016": { "label": "옵티마", "build": "optima", "year": "2016", "msrp": "22140", "mpg": "30", "cat": "midlux", "korean": true, "awards": true, "review": "kbb", "altbuild": "" },
    "optimahybrid2017": { "label": "옵티마 하이브리드", "build": "optima-hybrid", "year": "2017", "msrp": "25995", "mpg": "42", "cat": "midlux", "korean": true, "awards": true, "review": "kbb", "altbuild": "optima hybrid" },
//  "optimahybrid2016": { "label": "옵티마 하이브리드", "build": "optima-hybrid", "year": "2016", "msrp": "25995", "mpg": "38", "cat": "midlux", "korean": true, "awards": true, "review": "kbb", "altbuild": "optima hybrid" },
    "optimapluginhybrid2017": { "label": "옵티마 플러그인 하이브리드", "build": "optima-plug-in-hybrid", "year": "2017", "msrp": "35210", "mpg": "40", "cat": "midlux", "korean": true, "awards": true, "review": "", "altbuild": "optima plug-in hybrid" },
    "cadenza2017": { "label": "카덴자", "build": "cadenza", "year": "2017", "msrp": "31990", "mpg": "23", "cat": "midlux", "korean": true, "awards": false, "review": "", "altbuild": "" },
//  "cadenza2016": { "label": "카덴자", "build": "cadenza", "year": "2016", "msrp": "32990", "mpg": "22", "cat": "midlux", "korean": true, "awards": false, "review": "", "altbuild": "" },
    "k9002017": { "label": "K900", "build": "k900", "year": "2017", "msrp": "49900", "mpg": "20", "cat": "midlux", "korean": true, "awards": false, "review": "", "altbuild": "" },
//  "k9002016": { "label": "K900", "build": "k900", "year": "2016", "msrp": "49000", "mpg": "20", "cat": "midlux", "korean": true, "awards": false, "review": "", "altbuild": "" },
    "soul2017": { "label": "쏘울", "build": "soul", "year": "2017", "msrp": "16100", "mpg": "28", "cat": "crossover", "korean": true, "awards": true, "review": "kbb", "altbuild": "" },
//  "soul2016": { "label": "쏘울", "build": "soul", "year": "2016", "msrp": "15900", "mpg": "27", "cat": "crossover", "korean": true, "awards": true, "review": "kbb", "altbuild": "" },
    "soulev2017": { "label": "쏘울 EV", "build": "soul-ev", "year": "2017", "msrp": "32250", "mpg": "93", "cat": "crossover", "korean": true, "awards": true, "review": "kbb", "altbuild": "soul ev" },
//  "soulev2016": { "label": "쏘울 EV", "build": "soul-ev", "year": "2016", "msrp": "31950", "mpg": "93", "cat": "crossover", "korean": true, "awards": true, "review": "kbb", "altbuild": "soul ev" },
    "niro2017": { "label": "니로", "build": "niro", "year": "2017", "msrp": "22890", "mpg": "", "cat": "crossover", "korean": true, "awards": true, "review": "", "altbuild": "" },
    "sorento2018": { "label": "쏘렌토", "build": "sorento", "year": "2018", "msrp": "25800", "mpg": "24", "cat": "crossover", "korean": true, "awards": true, "review": "kbb", "altbuild": "" },
    "sorento2017": { "label": "쏘렌토", "build": "sorento", "year": "2017", "msrp": "25600", "mpg": "24", "cat": "crossover", "korean": true, "awards": true, "review": "kbb", "altbuild": "" },
//  "sorento2016": { "label": "쏘렌토", "build": "sorento", "year": "2016", "msrp": "25100", "mpg": "24", "cat": "crossover", "korean": true, "awards": true, "review": "kbb", "altbuild": "" },
    "sedona2017": { "label": "세도나", "build": "sedona", "year": "2017", "msrp": "26900", "mpg": "21", "cat": "crossover", "korean": true, "awards": true, "review": "", "altbuild": "" },
//  "sedona2016": { "label": "세도나", "build": "sedona", "year": "2016", "msrp": "26400", "mpg": "21", "cat": "crossover", "korean": true, "awards": true, "review": "", "altbuild": "" },
    "forte2017": { "label": "포르테", "build": "forte", "year": "2017", "msrp": "1660", "mpg": "32", "cat": "compact", "korean": true, "awards": true, "review": "kbb", "altbuild": "" },
//  "forte2016": { "label": "포르테", "build": "forte", "year": "2016", "msrp": "15990", "mpg": "31", "cat": "compact", "korean": true, "awards": true, "review": "kbb", "altbuild": "" },
    "forte52017": { "label": "포르테5", "build": "forte5", "year": "2017", "msrp": "18200", "mpg": "28", "cat": "compact", "korean": true, "awards": false, "review": "kbb", "altbuild": "" },
//  "forte52016": { "label": "포르테5", "build": "forte5", "year": "2016", "msrp": "18090", "mpg": "28", "cat": "compact", "korean": true, "awards": false, "review": "kbb", "altbuild": "" },
//  "fortekoup2016": { "label": "포르테 쿱", "build": "forte-koup", "year": "2016", "msrp": "19890", "mpg": "28", "cat": "compact", "korean": true, "awards": false, "review": "kbb", "altbuild": "koup" },
    "rio2017": { "label": "리오", "build": "rio", "year": "2017", "msrp": "14165", "mpg": "31", "cat": "compact", "korean": true, "awards": false, "review": "", "altbuild": "" },
//  "rio2016": { "label": "리오", "build": "rio", "year": "2016", "msrp": "14165", "mpg": "31", "cat": "compact", "korean": true, "awards": false, "review": "", "altbuild": "" },
    "rio5door2017": { "label": "리오 5-Door", "build": "rio-5-door", "year": "2017", "msrp": "15495", "mpg": "31", "cat": "compact", "korean": true, "awards": false, "review": "", "altbuild": "" },
//  "rio5door2016": { "label": "리오 5-Door", "build": "rio-5-door", "year": "2016", "msrp": "15495", "mpg": "31", "cat": "compact", "korean": true, "awards": false, "review": "", "altbuild": "" },
    "stinger2018": { "label": "스팅어", "build": "stinger", "year": "2018", "msrp": "출시예정", "mpg": "", "cat": "midlux", "korean": false, "awards": false, "review": "", "altbuild": "" },
    "niropluginhybrid2018": { "label": "니로 플러그인 하이브리드", "build": "niro-plug-in-hybrid", "year": "2018", "msrp": "출시예정", "mpg": "", "cat": "crossover", "korean": false, "awards": false, "review": "", "altbuild": "" },
    "optima2018": { "label": "옵티마", "build": "optima", "year": "2018", "msrp": "22500", "mpg": "31", "cat": "midlux", "korean": true, "awards": true, "review": "kbb", "altbuild": "" },
    "sportage2018": { "label": "스포티지", "build": "sportage", "year": "2018", "msrp": "23500", "mpg": "26", "cat": "crossover", "korean": true, "awards": true, "review": "kbb", "altbuild": "" },
    "soul2018": { "label": "쏘울", "build": "soul", "year": "2018", "msrp": "16100", "mpg": "28", "cat": "crossover", "korean": true, "awards": true, "review": "kbb", "altbuild": "" },
    "rio2018": { "label": "리오", "build": "rio", "year": "2018", "msrp": "13900", "mpg": "32", "cat": "compact", "korean": true, "awards": false, "review": "", "altbuild": "" },
    "rio5door2018": { "label": "리오 5-Door", "build": "rio-5-door", "year": "2018", "msrp": "14200", "mpg": "32", "cat": "compact", "korean": true, "awards": false, "review": "", "altbuild": "" }
};
// access these through kiaModels["optima2016"].build and so on

var pageBuild = "niro2017";  // default build in case it's missing
var siteMoveMsg = "기아자동차 영문 사이트로 이동합니다. \n이동하시려면 OK 버튼을 클릭하십시오.";

function includeHTML(targetObj, targetFile) {
    var fullTarget = "/us/kr/includes/" + targetFile;
    $.ajax({
        url: "/us/kr/includes/" + targetFile,
        context: document.body,
        success: function (responseText) {

            $(targetObj).load(fullTarget);
            $(targetObj).find("script").each(function (i) {
                eval($(this).text());
            });
        }
    });

}


function callExternalLink() {
    // $("footer a, header a").click  === for two only, currently redirecting all /us/en

    $("footer a, header a, #content-container a, .vehicle-menu a, .vehicle-shortmenu a, .vehicle-list-menu a, a.gallery-link, .miy-container a").click(function (e) {
        e.preventDefault();
        //alert(/^\/us\/en+/i.test($(this).attr('href')) + $(this).attr('href'));
        var targetURL = $(this).attr('href');
        var targetWindow = $(this).attr('target');
/*
        if (e.attr('id') == 'id-summerevent') {
            fbq('track', 'ViewContent', {
                content_ids: ['SummerEvent2017'],
                content_type: 'page',
                page: 'SummerEvent-English'
            });
        }
*/
        //alert($(this).attr('href') + '\n' + targetURL.indexOf("http://www.kia.com") + '\n' + targetURL.indexOf("https://www.kia.com"));
/*
        if (/^\/us\/en+/i.test($(this).attr('href'))) {
            //                if (confirm("영문 사이트로 이동합니다.\n이동하시려면 OK 나 확인 버튼을 눌러주세요.")) {
            bootbox.hideAll();
            bootbox.confirm(siteMoveMsg, function (result) {
                if (result) {
                    //alert(targetURL);
                    window.location.href = "http://www.kia.com" + targetURL;
                } else {
                   
                    //return;//just close
                }
            });
        } else */
        if (targetURL.indexOf("http://www.kia.com") >= 0 || targetURL.indexOf("https://www.kia.com") >= 0) {
            //alert(/^\/us\/en+/i.test($(this).attr('href')) + $(this).attr('href'));
            //alert($(this).attr('href'));
            bootbox.hideAll();
            siteMoveMsg = "기아자동차 영문 사이트로 이동합니다. \n이동하시려면 OK 버튼을 클릭하십시오.";
            bootbox.confirm(siteMoveMsg, function (result) {
                if (result) {
                    // window.location.href =  targetURL;
                    window.open(targetURL, targetWindow);
                } else {
                    //alert(result);
                    return;//just close
                }
            });
        } else if (/\/us\/kr+/i.test(targetURL) || targetURL.indexOf("#") == 0) {
            // if contains /us/kr anywhere, just move to the target
            
            window.location.href = targetURL;
            return;
        } else if (targetURL.indexOf("javascript") == 0) {
            // do nothing
        }
        else {
            // if the target is not kia us site or local
            siteMoveMsg = "기아자동차 사이트가 아닌 <b>타 웹사이트로</b> 이동합니다.\n이동하시려면 OK 나 확인 버튼을 눌러주세요.";
            bootbox.hideAll();
            bootbox.confirm(siteMoveMsg, function (result) {
                if (result) {
                    // window.location.href =  targetURL;
                    window.open(targetURL, targetWindow);
                } else {
                    //alert(result);
                    //return;//just close
                }
            });
        }
        $("body").css("padding-right", "0");
    });
}

    function createBuildLinks(selectorRange) {
        /* hard coded following logic
        var replLink;
        if (kiaModels[pageBuild].korean) {
            replLink = "/us/kr";
        } else {
            replLink = "http://www.kia.com/us/en";
        }
        */
        // I F**KIN HATE DOING THIS BUT I HAVE TO MAKE SPECIAL CASES FOR 2018 MODELS WITHOUT AWARDS YET
        //!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! ffffffffffffffffffffffffffffffffffffffffff
        if (kiaModels[pageBuild].year == "2018") {
            var awardsLink = (kiaModels[pageBuild].awards == true ? "awards-2017" + "-" + kiaModels[pageBuild].build : "awards-kia-motors");
        } else {
            var awardsLink = (kiaModels[pageBuild].awards == true ? "awards-" + kiaModels[pageBuild].year + "-" + kiaModels[pageBuild].build : "awards-kia-motors");
        }

        var externalBuild = (kiaModels[pageBuild].altbuild == "" ? kiaModels[pageBuild].build : kiaModels[pageBuild].altbuild);

        if (kiaModels[pageBuild].review == "") {
            var reviewLink = "content/why-kia/ratings-and-reviews/jdpower-circle-ratings/kia-brand";
        } else // else if revew == "kbb"
        {
            var reviewLink = "content/why-kia/ratings-and-reviews/kelley-blue-book/" + kiaModels[pageBuild].build;
        }
        $(selectorRange)
        .each (function()
        {
            //alert(this.href);
            this.href = decodeURIComponent(this.href).replace(/{build}/gi, kiaModels[pageBuild].build);
            this.href = decodeURIComponent(this.href).replace(/{year}/gi, kiaModels[pageBuild].year);
            this.href = decodeURIComponent(this.href).replace(/{label}/gi, kiaModels[pageBuild].label);
            this.href = decodeURIComponent(this.href).replace(/{altbuild}/gi, externalBuild);

            this.href = decodeURIComponent(this.href).replace(/{awards}/gi, awardsLink);
            this.href = decodeURIComponent(this.href).replace(/{review}/gi, reviewLink);

            //alert(this.href);
            //this.href = decodeURIComponent(this.href).replace(/{link}/gi, replLink);
            //alert(this.href);
        });

    }

    function fillBuildText(selectorRange) {
        $(selectorRange)
            .each(function () {
                this.innerHTML = decodeURIComponent(this.innerHTML).replace(/{build}/gi, kiaModels[pageBuild].build);
                this.innerHTML = decodeURIComponent(this.innerHTML).replace(/{year}/gi, kiaModels[pageBuild].year);
                this.innerHTML = decodeURIComponent(this.innerHTML).replace(/{label}/gi, kiaModels[pageBuild].label);
                //this.innerHTML = decodeURIComponent(this.innerHTML).replace(/{link}/gi, replLink);
                //alert(kiaModels[pageBuild].korean);

            });
    }

    function createDisclaimer() {
        if ($(".disclaimer").length) {

            //following line prevents click event initialized and called multiple times by .load / external html event
            $(".disclaimer").off('click').on('click', function () {
                bootbox.alert($(this).attr('content'));
            });

            //$(".disclaimer").click(function () {
            //    bootbox.alert($(this).attr('content'));
            //});
        }

        //following added procedure for distinct disclaimers by sections
        //their disclaimer content should be in side footer tag
        if ($(".dist-disclaimer").length) {
            $(".dist-disclaimer").off('click').on('click', function () {
                bootbox.alert($(".footer-container").attr('content'));
            });
        }

        if ($(".footer-container").hasClass("hide-disclaimer")) {
            $(".disclaimer-list").hide();
        }
    }

    function formatCurrency(amount) {
        return '$' + amount.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
    }

    function activateDropdownMenu() {
        $(".show-submenu").click(function (e) {
            //alert(e.target.id);
            e.preventDefault();
            //$(e.target.attr('href')).toggle();
            $('.collapse').toggle();
        });
    }

// Note by Dennis
// I had to bring vehicle list specific function to general JS to prevent adding listner when it's not in vehicle list page
    function vehicleFilter() {
        $(".vehicle-filter").click(function (e) {
            e.preventDefault();

            if ($(".vehicle-list-menu").length > 0) {
                //move underline to selected menu
                $(".l2-ul-container LI").removeClass("selected");
                $(this).parent().addClass("selected");

                //show hide selected vehicle category
                displayGroup($(this).attr('content'));
            }
            /*
                    if (e.target.id == "all") {
                        $(".vehicle-types").slideDown();
                    } else {
                        $(".vehicle-types").hide();
                        $("#id-" + e.target.id).slideDown();
                    }
             */
        });
    }


$(document).ready(function () {
    //includeHTML ( ".header-container", "HEADER FILE NAME IN THE INCLUDE FOLDER");
/*
    if ($(".miy").length) {
        includeHTML(".miy", "kr_makeityours.html");
    }
*/
    if ($(".header-container").length) {
        includeHTML(".header-container", "kr_header.html");
    }
    
    if ($(".vehicle-menu").length) {
        includeHTML(".vehicle-menu", "kr_vehiclemenu.html");
    }

    if ($(".vehicle-shortmenu").length) {
        includeHTML(".vehicle-shortmenu", "kr_vehiclemenu-short.html");
    }
    includeHTML(".footer-container", "kr_footer.html");


    createDisclaimer();

    //alert(kiaModels["optima2016"].msrp);

});